<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
						"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dmy.notice.dao.DmyNoticeMapper">
	<resultMap id="DmyNoticeVO" type="dmy.notice.vo.DmyNoticeVO">
		<result column="DNT_NO" property="dnt_no"/>
		<result column="DNT_SUBJECT" property="dnt_subject"/>
		<result column="DNT_CONTENT" property="dnt_content"/>
		<result column="DNT_FILE" property="dnt_file"/>
		<result column="DNT_IMAGE" property="dnt_image"/>
		<result column="DNT_VIEWCNT" property="dnt_viewcnt"/>
		<result column="DNT_INSERTDATE" property="dnt_insertdate"/>
		<result column="DNT_UPDATEDATE" property="dnt_updatedate"/>
 		<result column="DNT_DELETEYN" property="dnt_deleteyn"/>
	</resultMap>
	<!-- 게시물 전체 조회 -->
	<select id="noticeList" parameterType="DmyNoticeVO" resultType="DmyNoticeVO">
		SELECT * FROM(SELECT
			A.DNT_NO,
			A.DNT_SUBJECT,
			A.DNT_CONTENT,
			A.DNT_FILE,
			A.DNT_IMAGE,
			A.DNT_VIEWCNT,
			TO_CHAR(A.DNT_UPDATEDATE,'YYYY-MM-DD')  AS DNT_UPDATEDATE,
			TO_CHAR(A.DNT_INSERTDATE,'YYYY-MM-DD')  AS DNT_INSERTDATE,
			A.DNT_DELETEYN,
			CEIL(ROW_NUMBER() OVER(ORDER BY A.DNT_NO) / B.DPG_PAGESIZE) DPG_CURPAGE,
			COUNT(A.DNT_NO) OVER() AS DPG_TOTALSIZE,
			B.DPG_PAGESIZE AS DPG_PAGESIZE,
			B.DPG_GROUPSIZE AS DPG_GROUPSIZE
			FROM DMY_NOTICE A, (SELECT * FROM DMY_PAGING WHERE DPG_TABLENO='05') B
			<where>
				A.DNT_DELETEYN = 'Y'
				<if test="searchFilter=='제목'">
					<![CDATA[AND A.DNT_SUBJECT LIKE '%'||#{keyword}||'%']]>
				</if>
				<if test="searchFilter=='내용'">
					<![CDATA[AND A.DNT_CONTENT LIKE '%'||#{keyword}||'%']]>
				</if>
				<if test="searchFilter=='제목+내용'">
				<![CDATA[AND A.DNT_SUBJECT LIKE '%'||#{keyword}||'%']]>
				<![CDATA[OR A.DNT_CONTENT LIKE '%'||#{keyword}||'%']]>
				</if>
				<if test="dnt_content != null and dnt_content !=''">
					AND A.DNT_CONTENT = #{dnt_content}
				</if>
			</where>
			ORDER BY 1 DESC
			)
			WHERE DPG_CURPAGE =#{dpg_curPage}
	</select>
</mapper>